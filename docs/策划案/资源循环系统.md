# Mindustry 资源循环系统策划案

## 概述

基于对Mindustry源码的深入分析，本文档详细阐述了游戏的资源循环系统设计理念、实现机制和平衡策略。该系统构建了一个多层次、相互依赖的资源经济网络，为玩家提供了深度的策略思考空间。

## 1. 资源类型架构

### 1.1 物品系统 (Item System)

#### 核心属性设计
```java
// 基础物理属性
explosiveness: float   // 爆炸性 (0.0-1.0)
flammability: float    // 易燃性 (0.0-1.0)
radioactivity: float   // 放射性 (0.0-1.0)
charge: float          // 电荷值 (影响电力传输)
hardness: int          // 硬度 (影响开采难度)

// 经济属性
cost: float            // 建造时间倍数
healthScaling: float   // 建筑血量加成
buildable: boolean     // 可否用于建造
lowPriority: boolean   // 开采优先级
```

#### 资源分级设计

**基础资源 (Tier 1)**
- 铜矿 (Copper): 硬度1, 万能基础材料
- 铅矿 (Lead): 硬度1, 防护与子弹材料
- 沙子 (Sand): 硅和玻璃的原料, 不可建造
- 煤炭 (Coal): 易燃性1.0, 能源材料

**加工资源 (Tier 2)**
- 硅 (Silicon): 煤+沙 → 硅, 电子材料基础
- 石墨 (Graphite): 煤炼制, 高温材料
- 超合金玻璃 (Metaglass): 铅+沙, 透明防护材料
- 塑钢 (Plastanium): 钛+石油+孢子, 轻质高强度

**高级资源 (Tier 3)**
- 相位纤维 (Phase Fabric): 沙+钍, 传送科技核心
- 电涌合金 (Surge Alloy): 铜+铅+钛+硅, 电荷0.75

**星球特有资源 (Erekir)**
- 铍 (Beryllium): 新星球基础材料
- 钨 (Tungsten): 高硬度金属
- 氧化物 (Oxide): 化学反应材料
- 碳化物 (Carbide): 最高级合成材料

### 1.2 液体系统 (Liquid System)

#### 热力学属性
```java
temperature: float     // 温度值 (影响反应和冷却)
heatCapacity: float    // 热容量 (冷却效率)
boilPoint: float       // 沸点 (状态变化临界点)
viscosity: float       // 粘度 (流动阻力)
gas: boolean          // 气体标志 (影响动画和物理)
```

#### 液体分类

**冷却剂类**
- 水 (Water): 热容量0.4, 基础冷却剂
- 冷冻液 (Cryofluid): 温度0.25, 高效冷却

**能源液体**
- 石油 (Oil): 易燃性1.2, 爆炸性1.2
- 熔渣 (Slag): 温度1.0, 高温副产品

**工业气体**
- 臭氧 (Ozone): gas=true, 氧化剂
- 氢气 (Hydrogen): 高能燃料
- 氮气 (Nitrogen): 惰性保护气体
- 氰化物 (Cyanogen): 剧毒工业原料

## 2. 生产系统机制

### 2.1 开采系统 (Mining System)

#### 效率计算公式
```java
drillTime = (baseDrillTime + hardnessDrillMultiplier * item.hardness) / drillMultipliers.get(item, 1f)
```

#### 开采分级策略
```
等级1钻机: 可开采硬度≤1的材料 (铜、铅、煤)
等级2钻机: 可开采硬度≤2的材料 (钛、石英)
等级3钻机: 可开采硬度≤3的材料 (钍等高级材料)
```

#### 液体增幅机制
- 默认增幅倍数: `liquidBoostIntensity = 1.6x`
- 冷却液供应时提升开采速度60%
- 不同液体提供不同增幅效果

#### 多矿优先级算法
```java
1. 优先选择非lowPriority的矿物
2. 按矿物数量排序 (多的优先)
3. 相同数量按ID排序 (确定性选择)
```

### 2.2 合成系统 (Crafting System)

#### 进度计算机制
```java
progress += getProgressIncrease(craftTime)
// getProgressIncrease = 1f / craftTime * edelta() * efficiency
```

#### 效率影响因子
- **电力供应**: 电力不足按比例降低效率
- **液体增幅**: 冷却液或特殊液体提供速度加成
- **环境因子**: 温度、辐射等环境条件影响

#### 典型生产链案例
```
硅生产链:
煤(1) + 沙(2) → [40帧, 0.5电力] → 硅(1)

高级硅生产:
硅(1) + 煤(1) → [90帧, 2.5电力] → 硅(8)
(使用属性加成可达8倍产出)
```

### 2.3 反向压力机制 (Back-pressure)

#### 物品背压
- 输出缓冲区满时停止生产
- 传送带堵塞向上游传播
- `clogHeat`系统记录堵塞程度

#### 液体溢出
- `dumpExtraLiquid`允许溢出多余液体
- 混合限制: 仅接受相同液体或近空状态(`< 0.2f`)

## 3. 分配网络设计

### 3.1 物品传输系统

#### 离散物品机制
```java
// 物品位置数组
float[] xs, ys;          // 每个物品的精确位置
byte[] items;            // 物品类型标识
itemSpace = 0.4f;        // 物品间距参数
```

#### 流量控制
- 最大容量: 每条传送带3个物品
- 速度参数: `speed`决定移动速率
- 流通条件: `pass(item)`检查下游接受能力

#### 堵塞检测
```java
if(minItem < itemSpace) {
    clogHeat += 1f / 60f;  // 每秒增加堵塞热度
}
```

### 3.2 液体传输系统

#### 连续流体机制
- 液体以连续数量流动，非离散单位
- `moveLiquidForward()`处理流向计算
- 支持多方向同时流动

#### 混合防护
```java
// 只接受相同液体或容器近空
boolean canAccept = liquid == null || liquid == targetLiquid || amount < 0.2f;
```

#### 泄漏机制
- `leaks`参数允许运输过程中的损耗
- 模拟管道破损或不完美密封

### 3.3 电力网络系统

#### 图算法架构
```java
PowerGraph graph = new PowerGraph();
// BFS连通性检测
// 所有连接的电力建筑形成统一电网
```

#### 电力平衡计算
```java
powerBalance = getPowerProduced() - getPowerNeeded();
coverage = Math.min(1f, powerProduced / powerNeeded);
```

#### 电池缓冲机制
- 电力过剩时充电电池
- 电力不足时放电电池
- 提供电网稳定性

## 4. 平衡策略设计

### 4.1 效率递减机制

#### 硬度递增
```
铜铅 (硬度1) → 钛 (硬度2) → 钍 (硬度3+)
开采时间随硬度线性增长
```

#### 复杂度递增
```
基础材料: 直接开采
二级材料: 1-2步合成
三级材料: 3-4步合成链
顶级材料: 5+步复杂链条
```

### 4.2 资源稀缺性设计

#### 地理分布
- 基础资源: 广泛分布，易获取
- 高级资源: 稀有矿脉，需探索
- 星球专属: 跨星球贸易需求

#### 时间稀缺
- 早期: 简单资源充足
- 中期: 加工瓶颈显现
- 后期: 高级资源竞争激烈

### 4.3 规模效益与边际递减

#### 生产规模收益
```
单一生产线: 基础效率
并行生产线: 线性扩展
优化布局: 额外效率奖励
```

#### 运输瓶颈
- 传送带容量限制
- 长距离运输延迟
- 分岔口堵塞风险

## 5. 高级优化策略

### 5.1 生产链优化

#### 吞吐量优化
- 传送带速度匹配生产节拍
- 并行生产线分担负载
- 缓冲区合理配置

#### 效率优化
- 电力供应充足性保证
- 冷却液增幅合理配置
- 运输距离最小化

### 5.2 资源回收系统

#### 分离器回收
- 分离器可提取混合物品
- 拆解器回收建筑材料
- 减少资源浪费

#### 副产品利用
- 热能链式利用
- 废料转化再利用
- 循环经济闭环

### 5.3 智能布局设计

#### 模块化设计
- 标准化生产模块
- 可扩展接口设计
- 维护通道预留

#### 容灾备份
- 关键节点备份
- 多路径冗余设计
- 故障隔离机制

## 6. 策划设计要点

### 6.1 玩家引导策略

#### 渐进式复杂度
```
第1阶段: 铜+铅基础工业
第2阶段: 硅+石墨电子时代
第3阶段: 相位+电涌高科技
第4阶段: 跨星球资源整合
```

#### 决策点设计
- 资源分配优先级选择
- 科技发展路径选择
- 防御与发展平衡选择

### 6.2 动态平衡机制

#### 自适应难度
- 生产效率影响敌人强度
- 资源丰富度影响攻击频率
- 科技进度触发新挑战

#### 多样化解决方案
- 相同目标的不同实现路径
- 资源约束下的创新解决方案
- 时间与空间的权衡选择

## 结论

Mindustry的资源循环系统通过多层次的相互依赖、效率机制和平衡策略，创造了一个具有深度和可玩性的经济系统。该系统的核心在于：

1. **分层复杂度**: 从简单到复杂的渐进式设计
2. **效率驱动**: 玩家需要不断优化生产效率
3. **平衡制约**: 多种限制因子避免单一最优解
4. **创新空间**: 为玩家创新和优化留出充足空间

这种设计理念可以为类似游戏的资源系统设计提供重要参考价值。