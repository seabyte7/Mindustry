# Mindustry 热量传导系统策划案

## 📋 文档信息

**策划类型**: 核心玩法机制
**优先级**: 🔥 高优先级
**影响范围**: 中后期产业链、资源生产、战斗系统
**技术架构**: 基于物理传导的热量网络系统
**源码位置**: `world/blocks/heat/`

---

## 🎯 系统概述

### 设计理念

热量传导系统是Mindustry中的一个创新性资源管理机制，它模拟了现实世界中的热量传递过程。该系统通过**空间邻接传导**的方式，为游戏引入了一个新的资源维度，增加了工厂布局的复杂性和策略深度。

### 核心特征

1. **物理邻接依赖**: 热量只能通过直接相邻的建筑传递
2. **方向性传导**: 热量生产者有明确的输出方向
3. **损耗传导**: 热量在传递过程中会产生损失
4. **过热加成**: 超过基础需求的热量可提供效率加成
5. **网络分流**: 支持复杂的热量分配网络

### 系统架构

```
HeatBlock (接口)
├── HeatProducer (热量生产者)
├── HeatConsumer (热量消费者)
└── HeatConductor (热量传导器)
```

**核心类定义**:
- `HeatBlock`: 基础热量接口 (`world/blocks/heat/HeatBlock.java`)
- `HeatProducer`: 热量生产器 (`world/blocks/heat/HeatProducer.java`)
- `HeatConsumer`: 热量消费者 (`world/blocks/heat/HeatConsumer.java`)
- `HeatConductor`: 热量传导器 (`world/blocks/heat/HeatConductor.java`)

---

## 🔥 热量生产机制

### 生产设施类型

#### 1. 燃料驱动型热源

**氧化室 (Oxidation Chamber)**
- **热量输出**: 5 热量单位
- **燃料消耗**: 臭氧 (2/60 单位/秒) + 铍
- **特点**: 基础热源，成本适中
- **用途**: 早期热量需求满足

**熔渣加热器 (Slag Heater)**
- **热量输出**: 8 热量单位
- **燃料消耗**: 熔渣 (40/60 单位/秒)
- **特点**: 中等热源，利用废料
- **用途**: 中期大量热量生产

#### 2. 电力驱动型热源

**电热器 (Electric Heater)**
- **热量输出**: 3 热量单位
- **电力消耗**: 100/60 电力/秒
- **特点**: 清洁能源，无材料消耗
- **用途**: 精确热量控制

#### 3. 高级材料型热源

**相位加热器 (Phase Heater)**
- **热量输出**: 15 热量单位
- **燃料消耗**: 相位物质
- **制作时间**: 480秒/次消耗
- **特点**: 最高效热源，后期专用
- **用途**: 高热量需求工艺

#### 4. 混合型热源

**加热发电机 (Heater Generator)**
- **热量输出**: 10 热量单位
- **额外功能**: 同时发电
- **特点**: 双重产出，空间效率高
- **用途**: 综合性能源中心

### 热量生产公式

**基础热量计算**:
```
实际热量 = 基础热量输出 × 建筑效率 × 预热系数
```

**预热机制**:
```
预热速度 = warmupRate × delta()
当前热量 = Mathf.approachDelta(当前热量, 目标热量, 预热速度)
```

其中:
- `warmupRate` = 0.15 (默认预热速率)
- `delta()` = 当前帧时间间隔
- `Mathf.approachDelta()` = Arc框架的平滑逼近函数

---

## ⚡ 热量消费与效率机制

### 消费设施分类

#### 1. 材料加工型

**大气浓缩器 (Atmospheric Concentrator)**
- **热量需求**: 6 热量单位
- **产出**: 氮气 (4/60 单位/秒)
- **效率影响**: 热量不足时停止生产

**碳化物坩埚 (Carbide Crucible)**
- **热量需求**: 10 热量单位
- **产出**: 碳化物
- **制作时间**: 135秒
- **材料消耗**: 钨×2 + 石墨×3

**合金坩埚 (Surge Crucible)**
- **热量需求**: 10 热量单位
- **产出**: 合金
- **制作时间**: 180秒
- **特殊效果**: 过热时有额外视觉效果

#### 2. 化学合成型

**氰气合成器 (Cyanogen Synthesizer)**
- **热量需求**: 5 热量单位
- **产出**: 氰气
- **特点**: 低热量需求，适合分布式布局

**相位合成器 (Phase Synthesizer)**
- **热量需求**: 8 热量单位
- **产出**: 相位物质
- **制作时间**: 120秒
- **特点**: 高价值产出

#### 3. 战斗设施型

**某些高级炮塔**
- **热量需求**: 10-72 热量单位
- **效果**: 提升射击效率和伤害
- **最大效率**: 200% (2倍基础效率)

### 效率计算公式

**基础效率计算**:
```
基础效率 = min(当前热量 / 需求热量, 1.0)
```

**过热加成计算**:
```
过热量 = max(当前热量 - 需求热量, 0)
过热加成 = (过热量 / 需求热量) × 过热系数
最终效率 = min(基础效率 + 过热加成, 最大效率)
```

**关键参数**:
- `heatRequirement`: 基础热量需求
- `overheatScale`: 过热系数 (默认1.0)
- `maxEfficiency`: 最大效率 (默认4.0，即400%)

**预热目标计算**:
```
预热目标 = clamp(当前热量 / 需求热量)
```

---

## 🌐 热量传导网络设计

### 传导设施类型

#### 1. 基础传导器

**热量重定向器 (Heat Redirector)**
- **尺寸**: 3×3
- **功能**: 单向热量传递
- **用途**: 改变热量传递方向
- **成本**: 钨×10 + 石墨×10

**小型热量重定向器 (Small Heat Redirector)**
- **尺寸**: 2×2
- **功能**: 单向热量传递
- **用途**: 紧凑布局的方向控制
- **成本**: 合金×10 + 石墨×10

#### 2. 分流传导器

**热量路由器 (Heat Router)**
- **尺寸**: 3×3
- **功能**: 将输入热量分为3等份输出
- **特殊属性**: `splitHeat = true`
- **用途**: 一对多热量分配
- **成本**: 钨×15 + 石墨×10

### 传导计算核心算法

**热量传导算法** (`BuildingComp.calculateHeat()`):

```
总热量 = 0
for each 邻接建筑 in proximity:
    if 建筑是热量生产者 && 朝向正确:
        接触差值 = min(abs(build.x - x), abs(build.y - y)) / tilesize
        接触点数 = min((block.size/2 + build.block.size/2 - 接触差值),
                      min(build.block.size, block.size))

        基础传导量 = 生产者热量 / 生产者尺寸 × 接触点数

        if 是热量路由器:
            传导量 = 基础传导量 / 3
        else:
            传导量 = 基础传导量

        sideHeat[方向] += 传导量
        总热量 += 传导量

return 总热量
```

**关键机制**:
1. **朝向检查**: 热量生产者必须面向消费者
2. **接触面积**: 根据建筑尺寸和位置计算实际接触面积
3. **热量分配**: 根据接触面积按比例分配热量
4. **分流机制**: 热量路由器将热量平均分给3个输出方向

### 网络拓扑规则

1. **无环路检测**: 防止热量在传导网络中循环
2. **单帧更新**: 同一游戏帧内每个建筑只计算一次热量
3. **方向限制**: 热量只能从生产者的输出面传导到相邻建筑
4. **距离衰减**: 热量传导受到建筑间接触面积影响

---

## 📊 数值平衡设计

### 热量供需平衡表

| 生产设施 | 热量输出 | 资源成本 | 效率评级 |
|----------|----------|----------|----------|
| 电热器 | 3 | 100电力/60s | ⭐⭐ |
| 氧化室 | 5 | 臭氧+铍 | ⭐⭐⭐ |
| 熔渣加热器 | 8 | 熔渣 | ⭐⭐⭐⭐ |
| 相位加热器 | 15 | 相位物质 | ⭐⭐⭐⭐⭐ |

| 消费设施 | 热量需求 | 产出价值 | 战略重要性 |
|----------|----------|----------|------------|
| 氰气合成器 | 5 | 氰气 | 🔥🔥🔥 |
| 大气浓缩器 | 6 | 氮气 | 🔥🔥 |
| 相位合成器 | 8 | 相位物质 | 🔥🔥🔥🔥 |
| 碳化物坩埚 | 10 | 碳化物 | 🔥🔥🔥 |
| 合金坩埚 | 10 | 合金 | 🔥🔥🔥🔥 |

### 热量传导效率

**传导损失模型**:
- 直接传导: 100% 效率
- 通过传导器: 100% 效率 (无损失)
- 路由器分流: 33.3% × 3 = 100% 总输出

**空间效率考量**:
- 3×3 生产设施最多可为 8 个相邻设施供热
- 热量路由器可将热量分配给非相邻设施
- 传导网络的空间占用成本需要权衡

---

## 🔗 系统交互设计

### 与电力系统的关系

1. **电热器**: 消耗电力产生热量
2. **加热发电机**: 消耗材料同时产生电力和热量
3. **热量消费设施**: 通常同时需要电力和热量
4. **过热保护**: 超过最大效率时不会造成设施损坏

### 与生产链的深度集成

**热量依赖的关键材料**:
- **氮气**: 冷却剂，用于高级生产
- **碳化物**: 高级合金材料
- **相位物质**: 终极科技材料
- **氰气**: 化学武器和高级电路

**产业链升级路径**:
```
电力系统 → 基础热量(电热器) → 初级热量生产(氮气)
→ 中级热量网络(碳化物) → 高级热量应用(相位物质)
```

### 与战斗系统的协同

1. **炮塔效率**: 热量不足时炮塔射速和伤害下降
2. **过热战术**: 提供超额热量获得战斗优势
3. **基地防护**: 热量设施成为敌人的优先攻击目标
4. **资源争夺**: 热量相关资源点的战略价值提升

### 与地图设计的相互影响

1. **空间布局**: 需要考虑热量传导的邻接需求
2. **防御设计**: 热量网络的脆弱性增加防御复杂度
3. **扩张策略**: 热量基础设施影响基地扩张计划
4. **地形利用**: 紧凑地形更适合热量网络建设

---

## 🎮 游戏策略深度分析

### 布局策略维度

#### 1. 集中式热量中心
**优势**:
- 热源利用效率最高
- 便于防护和升级
- 管理复杂度低

**劣势**:
- 单点故障风险
- 传导距离限制
- 空间需求大

#### 2. 分布式热量网络
**优势**:
- 抗干扰能力强
- 灵活适应地形
- 模块化扩展

**劣势**:
- 热源成本高
- 维护复杂度增加
- 效率可能较低

#### 3. 混合型热量架构
**优势**:
- 平衡效率与安全性
- 适应不同阶段需求
- 渐进式升级可能

**劣势**:
- 规划复杂度最高
- 需要丰富经验
- 资源投入大

### 决策复杂度提升

#### 1. 热量优先级管理
玩家需要决策：
- 哪些设施优先获得热量供应
- 如何在多个热量消费者间分配有限热量
- 何时扩建热量生产能力

#### 2. 网络拓扑优化
需要考虑：
- 传导路径的最短化
- 关键节点的冗余设计
- 热量路由器的最优配置

#### 3. 资源投入平衡
权衡因素：
- 热量设施 vs 其他基础设施的资源分配
- 短期效率 vs 长期可扩展性
- 防御投入 vs 生产投入

### 多人对战策略影响

#### 1. 新的攻击目标
- 热量生产设施成为高价值目标
- 破坏传导网络可以瘫痪大片生产区域
- 针对性的"断热"战术

#### 2. 防御策略演化
- 热量设施的重点防护
- 分散布局 vs 集中防御的权衡
- 快速修复机制的重要性

#### 3. 经济战策略
- 通过干扰热量供应影响对手经济
- 热量相关资源的控制和争夺
- 技术封锁战术的运用

---

## 🎨 视觉表现与反馈设计

### 热量传导的可视化

#### 1. 热量输入效果 (`DrawHeatInput`)
**视觉元素**:
- **颜色**: 红色渐变 (Color(1f, 0.22f, 0.22f, 0.8f))
- **脉冲效果**: 0.3倍脉冲强度，10倍脉冲频率
- **方向性**: 四个方向独立显示热量输入

**计算公式**:
```
透明度 = 基础透明度 × (当前热量/需求热量) × 脉冲系数
脉冲系数 = (1 - 脉冲强度 + sin(时间×脉冲频率) × 脉冲强度)
```

#### 2. 热量输出效果 (`DrawHeatOutput`)
**视觉特征**:
- 明确的方向指示
- 与输入效果的视觉区分
- 热量强度的直观表示

#### 3. 热量状态栏显示
**信息内容**:
- 当前热量值 / 需求热量值
- 效率百分比显示
- 过热状态的特殊标识

**显示公式**:
```
显示文本 = "热量: {当前热量}({效率%}%)"
进度条填充 = 当前热量 / 需求热量
```

### 音效反馈设计

#### 1. 环境音效
- **热量生产设施**: 持续的工业噪音 (`Sounds.extractLoop`)
- **传导过程**: 轻微的能量传递音效
- **过热状态**: 更激烈的运转声音

#### 2. 状态变化音效
- **热量不足**: 警告音效
- **达到最佳效率**: 满意的运转声
- **网络连接**: 连接成功的提示音

### 粒子效果系统

#### 1. 热量传导粒子
**在生产设施周围**:
- 热扰动粒子效果
- 温度相关的色彩变化
- 方向性的能量流动效果

#### 2. 过热特效
**超过基础需求时**:
- 更密集的粒子效果
- 颜色变化 (橙色→红色→白色)
- 强度随过热程度递增

---

## 📈 平衡性考量与设计哲学

### 核心设计原则

#### 1. **空间换效率**
热量系统通过占用更多空间来获得生产效率提升，这创造了有意义的资源权衡。

#### 2. **复杂度递增**
从简单的一对一热量供应，到复杂的多级传导网络，系统复杂度与游戏进程同步增长。

#### 3. **脆弱性与收益并存**
热量网络的集中化提高效率，但也创造了可被攻击的弱点。

#### 4. **多元化解决方案**
不同的热量生产方式适应不同的游戏情况和资源状况。

### 平衡性调整机制

#### 1. **热量需求的阶梯设计**
```
初级工艺: 3-6 热量单位
中级工艺: 8-10 热量单位
高级工艺: 10-15 热量单位
战斗应用: 10-72 热量单位
```

#### 2. **生产成本与效率的平衡**
每种热量来源都有其最适用的场景：
- 电热器：清洁但低效
- 燃料热源：高效但需要持续投入
- 高级热源：极高效但成本昂贵

#### 3. **传导损失的微调空间**
当前版本传导无损失，但系统架构支持未来添加传导损失机制。

### 未来扩展潜力

#### 1. **热量存储系统**
类似电池的热量存储设施，平滑供需波动。

#### 2. **高级传导技术**
更远距离的热量传输技术，打破邻接限制。

#### 3. **热量相关的环境机制**
环境温度、季节变化对热量系统的影响。

#### 4. **热量驱动的新设施类型**
完全依赖热量的新型生产或防御设施。

---

## 🔧 技术实现要点

### 关键算法复杂度

**热量计算时间复杂度**: O(n)，其中n为邻接建筑数量
**网络更新频率**: 每游戏帧一次
**内存占用**: 每建筑4个float (sideHeat数组)

### 性能优化策略

1. **缓存机制**: 避免同一帧内重复计算 (`lastHeatUpdate`)
2. **增量更新**: 只在网络拓扑变化时重新计算
3. **距离预检**: 预先排除不可能的热量传导

### 序列化支持

热量状态完全支持存档保存与加载：
```java
write.f(heat);  // 保存当前热量值
heat = read.f(); // 读取热量值
```

---

## 📋 总结与评价

### 系统优势

1. **策略深度**: 为玩家提供了新的优化维度
2. **空间规划**: 增加了基地布局的重要性
3. **技术进步感**: 热量技术体现了科技发展
4. **多人对战**: 创造了新的攻防战术

### 潜在挑战

1. **学习曲线**: 新玩家需要时间理解热量机制
2. **布局复杂度**: 可能让某些玩家感到压力
3. **平衡维护**: 需要持续关注数值平衡

### 对整体游戏的影响

热量传导系统成功地为Mindustry引入了一个**物理空间依赖**的新资源类型，这不仅丰富了游戏的技术内容，也为玩家创造了更多样化的策略选择空间。它体现了游戏设计中"约束创造趣味"的经典原则，通过空间限制和邻接依赖，将简单的生产消费关系转化为复杂的网络优化问题。

这一系统的成功实现证明了Mindustry在工业模拟和策略优化方面的设计深度，为同类游戏的系统设计提供了优秀的参考范例。

---

*本策划案基于Mindustry源代码深度分析，数据和机制描述均来自实际代码实现。*